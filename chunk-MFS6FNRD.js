import{a as le,b as he,c as pe,d as De}from"./chunk-3VHVEV36.js";import{a as se,b as ye}from"./chunk-VKGD23XU.js";import"./chunk-OCP6ILJ3.js";import"./chunk-WQPEQQJO.js";import{o as ie,q as fe}from"./chunk-ZNXBTVER.js";import{a as oe,b as ge}from"./chunk-BWHYGX4V.js";import"./chunk-HPUSM2II.js";import{$ as _,$a as V,$b as ne,A as Y,Ab as D,Ba as p,Bb as L,Cb as C,Db as j,Eb as Q,K as ue,Ka as k,Kb as v,Lb as X,Nb as A,Oa as E,T as M,Va as y,Wa as B,Xa as O,Ya as J,Yb as ee,Za as K,Zb as te,_a as T,_b as re,aa as S,ab as F,ac as ae,bb as i,bc as N,cb as o,db as I,eb as Z,fb as q,ga as z,gb as R,hb as w,ib as h,ic as U,oa as x,pb as G,qb as m,rb as H,sb as f}from"./chunk-77XPDUDI.js";import{d as $}from"./chunk-3A3XYTID.js";function ve(s,g){if(s&1){let e=R();i(0,"button",13),w("click",function(){let n=_(e).$implicit,a=h();return S(a.setRange(n.value))}),m(1),o()}if(s&2){let e=g.$implicit,t=h();O("bg-primary-600",t.performanceRange()===e.value)("text-white",t.performanceRange()===e.value)("border-primary-600",t.performanceRange()===e.value)("border-gray-200",t.performanceRange()!==e.value)("text-gray-600",t.performanceRange()!==e.value),p(),f(" ",e.label," ")}}function Ce(s,g){s&1&&(i(0,"div",11),m(1," No employees found for the selected range. "),o())}function _e(s,g){if(s&1){let e=R();i(0,"button",15),w("click",function(){let n=_(e).$implicit,a=h(2);return S(a.selectEmployee(n.id))}),i(1,"div",16)(2,"div",17),m(3),o(),i(4,"div",18)(5,"div",19)(6,"div")(7,"p",20),m(8),o(),i(9,"p",21),m(10),D(11,"date"),o()(),i(12,"div",22)(13,"p",23),m(14,"Total Drops"),o(),i(15,"p",24),m(16),D(17,"number"),o()()(),i(18,"div",25)(19,"div",26),m(20," Avg / Day: "),i(21,"span",27),m(22),D(23,"number"),o()(),i(24,"div",28)(25,"span"),m(26),o(),i(27,"span",26),m(28),D(29,"percent"),o()()()()()()}if(s&2){let e,t,n,a=g.$implicit,l=h(2);O("border-primary-500",((e=l.selectedEmployee())==null?null:e.id)===a.id)("bg-primary-50",((t=l.selectedEmployee())==null?null:t.id)===a.id)("border-gray-200",((n=l.selectedEmployee())==null?null:n.id)!==a.id),p(2),B("background-color",a.avatarColor),p(),f(" ",a.initials," "),p(5),H(a.name),p(2),f(" ",a.hireDate?C(11,17,a.hireDate,"mediumDate"):"Hire date unknown"," "),p(6),f(" ",L(17,20,a.totalDrops)," "),p(6),f(" ",C(23,22,a.averageDropsPerDay,"1.0-1")," "),p(3),J(l.getTrendClasses(a.trendDirection)),p(),f(" ",l.getTrendIcon(a.trendDirection)," "),p(2),f(" ",C(29,25,a.percentageOfTotal,"1.0-1")," ")}}function Se(s,g){if(s&1&&V(0,_e,30,28,"button",14,K().trackByEmployeeId,!0),s&2){let e=h();F(e.employeeSummaries())}}function Ee(s,g){if(s&1&&(Z(0),i(1,"div",31)(2,"div",32)(3,"div",33)(4,"div",17),m(5),o(),i(6,"div")(7,"p",34),m(8),o(),i(9,"p",35),m(10),D(11,"date"),o()()(),i(12,"div",22)(13,"p",23),m(14,"Contribution"),o(),i(15,"p",36),m(16),D(17,"percent"),o()()(),i(18,"div",37)(19,"div",38)(20,"p",39),m(21,"Total Drops"),o(),i(22,"p",40),m(23),D(24,"number"),o()(),i(25,"div",38)(26,"p",39),m(27,"Average / Day"),o(),i(28,"p",40),m(29),D(30,"number"),o()(),i(31,"div",38)(32,"p",39),m(33,"Amount"),o(),i(34,"p",40),m(35),D(36,"currency"),o()(),i(37,"div",38)(38,"p",39),m(39,"Average Amount / Day"),o(),i(40,"p",40),m(41),D(42,"currency"),o()()(),i(43,"div",41),I(44,"app-chart-wrapper",42)(45,"app-chart-wrapper",43),o(),I(46,"app-chart-wrapper",44),o(),q()),s&2){let e=g.ngIf,t=h(2);p(4),B("background-color",e.avatarColor),p(),f(" ",e.initials," "),p(3),H(e.name),p(2),f(" Hired: ",e.hireDate?C(11,19,e.hireDate,"longDate"):"Unknown"," "),p(6),f(" ",C(17,22,e.percentageOfTotal,"1.0-1")," "),p(7),f(" ",L(24,25,e.totalDrops)," "),p(6),f(" ",C(30,27,e.averageDropsPerDay,"1.0-1")," "),p(6),f(" ",j(36,30,e.amount,"$ ","symbol","1.0-0")," "),p(6),f(" ",j(42,35,e.averageAmountPerDay,"$ ","symbol","1.0-0")," "),p(3),y("chartData",t.employeeTrendChartData())("chartOptions",t.employeeTrendChartOptions)("chartType",t.lineChartType),p(),y("chartData",t.employeeDropTypeChartData())("chartOptions",t.employeeDropTypeChartOptions)("chartType",t.pieChartType),p(),y("chartData",t.employeeShiftChartData())("chartOptions",t.employeeShiftChartOptions)("chartType",t.barChartType)}}function Te(s,g){if(s&1&&(i(0,"app-card",29),E(1,Ee,47,40,"ng-container",30),o()),s&2){let e=h();p(),y("ngIf",e.selectedEmployee())}}function we(s,g){s&1&&(i(0,"div",45),m(1," Select an employee to view detailed performance charts. "),o())}var xe,me,de=$(()=>{"use strict";A();U();fe();ge();ye();A();U();xe=(s,g)=>g.value;me=(()=>{class s{avatarPalette=["#2563eb","#16a34a","#ea580c","#9333ea","#0ea5e9","#f97316","#dc2626","#14b8a6"];recordsSignal=x([]);set records(e){this.recordsSignal.set(Array.isArray(e)?e:[])}performanceRange=x("month");customStart=x(null);customEnd=x(null);selectedEmployeeId=x(null);rangeOptions=[{label:"Today",value:"today"},{label:"This Week",value:"week"},{label:"This Month",value:"month"},{label:"This Year",value:"year"}];filteredRecords=v(()=>{let e=this.recordsSignal(),t=this.performanceRange(),n=this.customStart(),a=this.customEnd(),{startDate:l,endDate:r}=this.getRangeBounds(t,n,a);if(!l&&!r)return e;var d=e.filter(u=>{let b=this.parseRecordDate(u);return!(!b||(console.log("startDate:",l,"endDate:",r,"recordDate:",b),l&&b<l)||r&&b>r)});return console.log("Filtered Records:",d),d});employeeSummaries=v(()=>{let e=this.filteredRecords();if(!e.length)return[];let t=new Map;e.forEach(r=>{let d=r.FIN||r.NAME||`employee-${r.Timestamp}`,u=r.NAME?.trim()||"Unknown",b=this.getInitials(u),c=t.get(d)||{id:d,name:u,initials:b,totalDrops:0,hireDate:null,dailyTotals:new Map,dropTypes:{"Multi Drops":0,"Heavy Drops":0,"Walkup Drop Count":0,"Double Drop Count":0},shifts:new Set,amount:0,multiDrops:0,heavyDrops:0,walkupDrops:0,doubleDrops:0,records:[]},P=this.parseRecordDate(r);if(P){c.hireDate=this.getEarlierDate(c.hireDate,P);let W=this.formatDateKey(P),ce=c.dailyTotals.get(W)??0;c.dailyTotals.set(W,ce+this.ensureNumber(r["Total Drops"]))}c.totalDrops+=this.ensureNumber(r["Total Drops"]),c.amount+=this.ensureNumber(r.Amount),c.multiDrops+=this.ensureNumber(r["Multi Drops"]),c.heavyDrops+=this.ensureNumber(r["Heavy Drops"]),c.walkupDrops+=this.ensureNumber(r["Walkup Drop Count"]),c.doubleDrops+=this.ensureNumber(r["Double Drop Count"]),c.dropTypes["Multi Drops"]+=this.ensureNumber(r["Multi Drops"]),c.dropTypes["Heavy Drops"]+=this.ensureNumber(r["Heavy Drops"]),c.dropTypes["Walkup Drop Count"]+=this.ensureNumber(r["Walkup Drop Count"]),c.dropTypes["Double Drop Count"]+=this.ensureNumber(r["Double Drop Count"]),r.Shift&&c.shifts.add(r.Shift),c.records.push(r),t.set(d,c)});let n=Array.from(t.values()),a=n.reduce((r,d)=>r+d.totalDrops,0),l=n.length?a/n.length:0;return n.map((r,d)=>{let u=r.dailyTotals.size||1,b=r.totalDrops/u,c=r.amount/u,P=r.totalDrops>l?"up":r.totalDrops<l?"down":"flat";return{id:r.id,name:r.name,initials:r.initials,avatarColor:this.avatarPalette[d%this.avatarPalette.length],totalDrops:r.totalDrops,averageDropsPerDay:b,averageAmountPerDay:c,hireDate:r.hireDate,percentageOfTotal:a?r.totalDrops/a:0,trendDirection:P,dailyTotals:r.dailyTotals,dropTypes:r.dropTypes,shifts:Array.from(r.shifts),amount:r.amount,multiDrops:r.multiDrops,heavyDrops:r.heavyDrops,walkupDrops:r.walkupDrops,doubleDrops:r.doubleDrops,records:r.records}}).sort((r,d)=>d.totalDrops-r.totalDrops)});selectedEmployee=v(()=>{let e=this.selectedEmployeeId(),t=this.employeeSummaries();if(!t.length)return null;if(e){let n=t.find(a=>a.id===e);if(n)return n}return t[0]});employeeTrendChartData=v(()=>{let e=this.selectedEmployee();if(!e)return this.createLineChartData([],[],"Daily Drops",{background:"rgba(59, 130, 246, 0.1)",border:"rgba(59, 130, 246, 1)"});let t=Array.from(e.dailyTotals.keys()).sort(),n=t.map(l=>this.formatDisplayDate(l)),a=t.map(l=>e.dailyTotals.get(l)??0);return this.createLineChartData(n,a,"Daily Drops",{background:"rgba(59, 130, 246, 0.1)",border:"rgba(59, 130, 246, 1)"})});employeeTrendChartOptions={elements:{line:{tension:.4}},scales:{y:{beginAtZero:!0}},plugins:{legend:{display:!1}},responsive:!0,maintainAspectRatio:!1};employeeDropTypeChartData=v(()=>{let e=this.selectedEmployee();if(!e)return this.createPieChartData([],[]);let t=Object.entries(e.dropTypes).filter(([,n])=>this.ensureNumber(n)>0);return t.length?this.createPieChartData(t.map(([n])=>n),t.map(([,n])=>n),["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)"]):this.createPieChartData([],[])});employeeDropTypeChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}};employeeShiftChartData=v(()=>{let e=this.selectedEmployee();if(!e)return this.createBarChartData([],[],"Drops by Shift");let t=this.groupAndSum(e.records,n=>n.Shift||"Unassigned","Total Drops");return this.createBarChartData(t.labels,t.values,"Drops by Shift",{background:"rgba(22, 163, 74, 0.8)",border:"rgba(22, 163, 74, 1)"})});employeeShiftChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}};isCustomRangeValid=v(()=>{let e=this.customStart(),t=this.customEnd();if(!e||!t)return!1;let n=new Date(e),a=new Date(t);return n.setHours(0,0,0,0),a.setHours(0,0,0,0),n<=a});lineChartType="line";pieChartType="pie";barChartType="bar";constructor(){X(()=>{let e=this.employeeSummaries(),t=this.selectedEmployeeId();if(!e.length){t!==null&&this.selectedEmployeeId.set(null);return}(t?e.some(a=>a.id===t):!1)||this.selectedEmployeeId.set(e[0].id)})}setRange(e){this.performanceRange.set(e),e!=="custom"&&(this.customStart.set(null),this.customEnd.set(null))}applyCustomRange(){this.isCustomRangeValid()&&this.performanceRange.set("custom")}updateCustomStart(e){this.customStart.set(e||null),this.customStart.set(e||null)}updateCustomEnd(e){this.customEnd.set(e||null)}selectEmployee(e){this.selectedEmployeeId.set(e)}trackByEmployeeId(e,t){return t.id}getRangeBounds(e,t,n){let a=new Date,l=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(e){case"today":return{startDate:l,endDate:new Date(l.getTime()+24*60*60*1e3-1)};case"week":{let r=new Date(l);return r.setDate(r.getDate()-6),{startDate:r,endDate:a}}case"month":return{startDate:new Date(a.getFullYear(),a.getMonth(),1),endDate:a};case"year":return{startDate:new Date(a.getFullYear(),0,1),endDate:a};case"custom":{let r=t?new Date(new Date(t).setHours(0,0,0,0)):null,d=n?new Date(new Date(n).setHours(0,0,0,0)):null;return{startDate:r,endDate:d}}default:return{startDate:null,endDate:null}}}parseRecordDate(e){let t=e.DATE||e.Timestamp;if(!t)return null;let n=new Date(t);return Number.isNaN(n.getTime())?null:n}getInitials(e){let t=e.split(" ").filter(Boolean);return t.length===0?"?":t.length===1?t[0].slice(0,2).toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}ensureNumber(e){if(typeof e=="number")return Number.isFinite(e)?e:0;let t=Number(e);return Number.isFinite(t)?t:0}getEarlierDate(e,t){return e?t<e?t:e:t}formatDateKey(e){return e.toISOString().split("T")[0]}formatDisplayDate(e){let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString(void 0,{month:"short",day:"numeric"})}createLineChartData(e,t,n,a){return{labels:e,datasets:[{data:t,label:n,backgroundColor:a.background,borderColor:a.border,pointBackgroundColor:a.border,pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:a.border,fill:"origin"}]}}createBarChartData(e,t,n,a={background:"rgba(59, 130, 246, 0.8)",border:"rgba(59, 130, 246, 1)"}){return{labels:e,datasets:[{data:t,label:n,backgroundColor:a.background,borderColor:a.border,borderWidth:1}]}}createPieChartData(e,t,n=[]){return{labels:e,datasets:[{data:t,backgroundColor:n.length>0?n:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:"#fff",borderWidth:1}]}}groupAndSum(e,t,n){let a=new Map;e.forEach(d=>{let u=t(d)||"Unknown",b=a.get(u)??0,c=this.ensureNumber(d[n]);a.set(u,b+c)});let l=Array.from(a.keys()),r=l.map(d=>a.get(d)??0);return{labels:l,values:r}}getTrendIcon(e){switch(e){case"up":return"\u2191";case"down":return"\u2193";default:return"\u2192"}}getTrendClasses(e){switch(e){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-500"}}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=k({type:s,selectors:[["app-performance-panel"]],inputs:{records:"records"},decls:20,vars:6,consts:[["noSelection",""],[1,"space-y-6"],[1,"flex","flex-col","gap-3","lg:flex-row","lg:items-center","lg:justify-between"],[1,"flex","flex-wrap","gap-2"],["type","button",1,"rounded-full","border","px-4","py-1.5","text-sm","font-medium","transition","focus:outline-none","focus:ring-2","focus:ring-primary-500",3,"bg-primary-600","text-white","border-primary-600","border-gray-200","text-gray-600"],[1,"flex","flex-wrap","items-center","gap-2"],["type","date",1,"rounded-md","border","border-gray-300","px-3","py-1.5","text-sm","focus:border-primary-500","focus:outline-none","focus:ring-2","focus:ring-primary-200",3,"change","value"],[1,"text-sm","text-gray-400"],["type","button",1,"rounded-md","bg-primary-600","px-4","py-1.5","text-sm","font-medium","text-white","transition","hover:bg-primary-700","focus:outline-none","focus:ring-2","focus:ring-primary-500","disabled:bg-gray-300","disabled:text-gray-500",3,"click","disabled"],[1,"grid","grid-cols-1","gap-6","lg:grid-cols-[320px_minmax(0,1fr)]"],[1,"space-y-4"],[1,"rounded-lg","border","border-dashed","border-gray-300","bg-gray-50","p-6","text-center","text-sm","text-gray-500"],["title","Performance Overview","padding","sm",4,"ngIf","ngIfElse"],["type","button",1,"rounded-full","border","px-4","py-1.5","text-sm","font-medium","transition","focus:outline-none","focus:ring-2","focus:ring-primary-500",3,"click"],["type","button",1,"w-full","rounded-xl","border","px-4","py-4","text-left","transition","focus:outline-none","focus:ring-2","focus:ring-primary-500",3,"border-primary-500","bg-primary-50","border-gray-200"],["type","button",1,"w-full","rounded-xl","border","px-4","py-4","text-left","transition","focus:outline-none","focus:ring-2","focus:ring-primary-500",3,"click"],[1,"flex","items-start","gap-4"],[1,"flex","h-12","w-12","items-center","justify-center","rounded-full","text-lg","font-semibold","text-white"],[1,"flex-1","space-y-2"],[1,"flex","items-center","justify-between","gap-2"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"text-right"],[1,"text-xs","text-gray-400"],[1,"text-sm","font-semibold","text-gray-900"],[1,"flex","items-center","justify-between","gap-2","text-xs"],[1,"text-gray-500"],[1,"font-medium","text-gray-900"],[1,"flex","items-center","gap-1"],["title","Performance Overview","padding","sm"],[4,"ngIf"],[1,"flex","flex-col","gap-4"],[1,"flex","flex-wrap","items-center","justify-between","gap-3"],[1,"flex","items-center","gap-3"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"text-base","font-medium","text-gray-900"],[1,"grid","grid-cols-2","gap-4","md:grid-cols-4"],[1,"rounded-lg","border","border-gray-200","bg-gray-50","p-3"],[1,"text-xs","uppercase","text-gray-400"],[1,"mt-1","text-lg","font-semibold","text-gray-900"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-2"],["title","Daily Drops Trend","subtitle","Drops completed per day","height","240px",3,"chartData","chartOptions","chartType"],["title","Drop Distribution","subtitle","Mix of drop types","height","240px",3,"chartData","chartOptions","chartType"],["title","Drops by Shift","subtitle","Shift allocation for this team member","height","240px",3,"chartData","chartOptions","chartType"],[1,"rounded-lg","border","border-dashed","border-gray-300","bg-gray-50","p-8","text-center","text-sm","text-gray-500"]],template:function(t,n){if(t&1){let a=R();i(0,"div",1)(1,"div",2)(2,"div",3),V(3,ve,2,11,"button",4,xe),o(),i(5,"div",5)(6,"input",6),w("change",function(r){return _(a),S(n.updateCustomStart((r.target==null?null:r.target.value)||""))}),o(),i(7,"span",7),m(8,"to"),o(),i(9,"input",6),w("change",function(r){return _(a),S(n.updateCustomEnd((r.target==null?null:r.target.value)||""))}),o(),i(10,"button",8),w("click",function(){return _(a),S(n.applyCustomRange())}),m(11," Apply "),o()()(),i(12,"div",9)(13,"div",10),E(14,Ce,2,0,"div",11)(15,Se,2,0),o(),i(16,"div",10),E(17,Te,2,1,"app-card",12)(18,we,2,0,"ng-template",null,0,Q),o()()()}if(t&2){let a=G(19);p(3),F(n.rangeOptions),p(3),y("value",n.customStart()||""),p(3),y("value",n.customEnd()||""),p(),y("disabled",!n.isCustomRangeValid()),p(4),T(n.employeeSummaries().length===0?14:15),p(3),y("ngIf",n.selectedEmployee())("ngIfElse",a)}},dependencies:[N,ee,re,ne,ae,te,ie,oe,se],encapsulation:2})}return s})()});function Pe(s,g){s&1&&(i(0,"div",3),m(1," Loading performance data\u2026 "),o())}function Ie(s,g){if(s&1&&(i(0,"div",4),m(1),o()),s&2){let e=h();p(),f(" ",e.error()," ")}}function ke(s,g){if(s&1&&I(0,"app-performance-panel",5),s&2){let e=h();y("records",e.performanceData())}}var Ke,Re=$(()=>{A();U();he();ue();De();de();A();Ke=(()=>{class s{dashboardService=M(pe);destroyRef=M(z);isLoading=x(!1);error=x(null);performanceData=x([]);ngOnInit(){this.loadPerformanceData()}loadPerformanceData(){this.isLoading.set(!0),this.error.set(null),this.dashboardService.getDashboardData().pipe(le(this.destroyRef),Y(()=>this.isLoading.set(!1))).subscribe({next:e=>{this.performanceData.set(this.convertSheetToJson(e))},error:e=>{this.error.set(this.extractErrorMessage(e)),this.performanceData.set([])}})}convertSheetToJson(e){let t=e&&Array.isArray(e.values)?e.values:[];if(t.length===0)return[];let n=t[0].map(l=>l?String(l).trim():"");return t.slice(1).map(l=>{let r={};return n.forEach((d,u)=>{l[u]!==void 0&&l[u]!==null&&String(l[u]).trim()!==""&&(r[d||`col_${u+1}`]=l[u]!==void 0?l[u]:"")}),r})}extractErrorMessage(e){return e instanceof Error||e&&typeof e=="object"&&"message"in e&&typeof e.message=="string"?e.message:"Unable to load performance data. Please try again later."}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=k({type:s,selectors:[["app-performance"]],decls:9,vars:3,consts:[[1,"space-y-6"],[1,"text-2xl","font-bold","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"rounded-md","border","border-primary-200","bg-primary-50","px-4","py-3","text-sm","text-primary-800"],[1,"rounded-md","border","border-red-200","bg-red-50","px-4","py-3","text-sm","text-red-700"],[3,"records"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"div")(2,"h1",1),m(3,"Performance"),o(),i(4,"p",2),m(5," Monitor employee drops, trends, and shift mix with interactive filters. "),o()(),E(6,Pe,2,0,"div",3)(7,Ie,2,1,"div",4)(8,ke,1,1,"app-performance-panel",5),o()),t&2&&(p(6),T(n.isLoading()?6:-1),p(),T(n.error()?7:-1),p(),T(!n.isLoading()&&!n.error()?8:-1))},dependencies:[N,me],encapsulation:2})}return s})()});Re();export{Ke as PerformanceComponent};
