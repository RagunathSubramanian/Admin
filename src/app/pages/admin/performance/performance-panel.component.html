<div class="space-y-6">
  <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
    <div class="flex flex-wrap gap-2">
      @for (option of rangeOptions; track option.value) {
        <button
          type="button"
          class="rounded-full border px-4 py-1.5 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-primary-500"
          [class.bg-primary-600]="performanceRange() === option.value"
          [class.text-white]="performanceRange() === option.value"
          [class.border-primary-600]="performanceRange() === option.value"
          [class.border-gray-200]="performanceRange() !== option.value"
          [class.text-gray-600]="performanceRange() !== option.value"
          (click)="setRange(option.value)"
        >
          {{ option.label }}
        </button>
      }
    </div>

    <div class="flex flex-wrap items-center gap-2">
      <input
        type="date"
        class="rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
        [value]="customStart() || ''"
        (change)="updateCustomStart($any($event.target)?.value || '')"
      />
      <span class="text-sm text-gray-400">to</span>
      <input
        type="date"
        class="rounded-md border border-gray-300 px-3 py-1.5 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"
        [value]="customEnd() || ''"
        (change)="updateCustomEnd($any($event.target)?.value || '')"
      />
      <button
        type="button"
        class="rounded-md bg-primary-600 px-4 py-1.5 text-sm font-medium text-white transition hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:bg-gray-300 disabled:text-gray-500"
        [disabled]="!isCustomRangeValid()"
        (click)="applyCustomRange()"
      >
        Apply
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-6 lg:grid-cols-[320px_minmax(0,1fr)]">
    <div class="space-y-4">
      @if (employeeSummaries().length === 0) {
        <div class="rounded-lg border border-dashed border-gray-300 bg-gray-50 p-6 text-center text-sm text-gray-500">
          No employees found for the selected range.
        </div>
      } @else {
        @for (employee of employeeSummaries(); track trackByEmployeeId($index, employee)) {
          <button
            type="button"
            class="w-full rounded-xl border px-4 py-4 text-left transition focus:outline-none focus:ring-2 focus:ring-primary-500"
            [class.border-primary-500]="selectedEmployee()?.id === employee.id"
            [class.bg-primary-50]="selectedEmployee()?.id === employee.id"
            [class.border-gray-200]="selectedEmployee()?.id !== employee.id"
            (click)="selectEmployee(employee.id)"
          >
            <div class="flex items-start gap-4">
              <div
                class="flex h-12 w-12 items-center justify-center rounded-full text-lg font-semibold text-white"
                [style.backgroundColor]="employee.avatarColor"
              >
                {{ employee.initials }}
              </div>
              <div class="flex-1 space-y-2">
                <div class="flex items-center justify-between gap-2">
                  <div>
                    <p class="text-sm font-medium text-gray-900">{{ employee.name }}</p>
                    <p class="text-xs text-gray-500">
                      {{
                        employee.hireDate
                          ? (employee.hireDate | date: 'mediumDate')
                          : 'Hire date unknown'
                      }}
                    </p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-gray-400">Drop Count</p>
                    <p class="text-sm font-semibold text-gray-900">
                      {{ employee.totalDrops | number }}
                    </p>
              
                  </div>
                </div>
                <div class="flex items-center justify-between gap-2 text-xs">
                  <div class="text-gray-500">
                    Avg / Day:
                    <span class="font-medium text-gray-900">
                      {{ employee.averageDropsPerDay | number: '1.0-1' }}
                    </span>
                  </div>
                  <div class="flex items-center gap-1">
                    <span [class]="getTrendClasses(employee.trendDirection)">
                      {{ getTrendIcon(employee.trendDirection) }}
                    </span>
                    <span class="text-gray-500">
                      {{ employee.percentageOfTotal | percent: '1.0-1' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </button>
        }
      }
    </div>

    <div class="space-y-4">
      <app-card *ngIf="selectedEmployee(); else noSelection" title="Performance Overview" padding="sm">
        <ng-container *ngIf="selectedEmployee() as employee">
          <div class="flex flex-col gap-4">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <div class="flex items-center gap-3">
                <div
                  class="flex h-12 w-12 items-center justify-center rounded-full text-lg font-semibold text-white"
                  [style.backgroundColor]="employee.avatarColor"
                >
                  {{ employee.initials }}
                </div>
                <div>
                  <p class="text-lg font-semibold text-gray-900">{{ employee.name }}</p>
                  <p class="text-sm text-gray-500">
                    Hired:
                    {{
                      employee.hireDate
                        ? (employee.hireDate | date: 'longDate')
                        : 'Unknown'
                    }}
                  </p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-400">Contribution</p>
                <p class="text-base font-medium text-gray-900">
                  {{ employee.percentageOfTotal | percent: '1.0-1' }}
                </p>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
              <div class="rounded-lg border border-gray-200 bg-gray-50 p-3">
                <p class="text-xs uppercase text-gray-400">Drop Count</p>
                <p class="mt-1 text-lg font-semibold text-gray-900">
                  {{ employee.totalDrops | number }}
                </p>
                <p class="mt-1 text-xs text-gray-500">
                  Single drops: {{ employee.totalDrops - employee.multiDrops - employee.heavyDrops - employee.doubleDrops | number }}
                </p>
                <p class="mt-1 text-xs text-gray-500">
                  Multi drops: {{ employee.multiDrops | number }}
                </p>
                <p class="mt-1 text-xs text-gray-500">
                  Heavy drops: {{ employee.heavyDrops | number }}
                </p>
                <p class="mt-1 text-xs text-gray-500">
                  Walkup drops: {{ employee.walkupDrops | number }}
                </p>
                <p class="mt-1 text-xs text-gray-500">
                  Double drops: {{ employee.doubleDrops | number }}
                </p>
               
              </div>
              <div class="rounded-lg border border-gray-200 bg-gray-50 p-3">
                <p class="text-xs uppercase text-gray-400">Average / Day</p>
                <p class="mt-1 text-lg font-semibold text-gray-900">
                  {{ employee.averageDropsPerDay | number: '1.0-1' }}
                </p>
                <p class="mt-1 text-xs text-gray-500">
                  Day Count : {{  employee.dailyTotals.size | number }}
                </p>
              </div>
             
              <div class="rounded-lg border border-gray-200 bg-gray-50 p-3">
                <p class="text-xs uppercase text-gray-400">Amount</p>
                <p class="mt-1 text-lg font-semibold text-gray-900">
                  {{ employee.amount | currency: '$  ':'symbol':'1.0-0' }}
                </p>
              </div>
               <div class="rounded-lg border border-gray-200 bg-gray-50 p-3">
                <p class="text-xs uppercase text-gray-400">Average Amount / Day</p>
                <p class="mt-1 text-lg font-semibold text-gray-900">
                  {{ employee.averageAmountPerDay | currency: '$  ':'symbol':'1.0-0' }}
                </p>
              </div>
            </div>

            <div class="grid grid-cols-1 gap-4 lg:grid-cols-2">
              <app-chart-wrapper
                title="Daily Drops Trend"
                subtitle="Drops completed per day"
                [chartData]="employeeTrendChartData()"
                [chartOptions]="employeeTrendChartOptions"
                [chartType]="lineChartType"
                height="240px"
              />

              <app-chart-wrapper
                title="Drop Distribution"
                subtitle="Mix of drop types"
                [chartData]="employeeDropTypeChartData()"
                [chartOptions]="employeeDropTypeChartOptions"
                [chartType]="pieChartType"
                height="240px"
              />
            </div>

            <app-chart-wrapper
              title="Drops by Shift"
              subtitle="Shift allocation for this team member"
              [chartData]="employeeShiftChartData()"
              [chartOptions]="employeeShiftChartOptions"
              [chartType]="barChartType"
              height="240px"
            />

            
          </div>
        </ng-container>
      </app-card>
  <!-- Drops Data Table -->
     <!-- <section>
    <h2 class="text-2xl font-semibold text-gray-900 mb-4">Data Table (Enhanced)</h2>
    <app-data-table
      [columns]="tableColumns"
      [data]="tabledata"
      [searchable]="true"
      [showFilters]="false"
      [pagination]="false"
      [ariaLabel]="'Enhanced users table'"
    />
  </section> -->
  <section>
    <app-card
      title="Grouped Summary"
      subtitle="Grouped by Date and Name (excluding Shift)"
      padding="sm"
    >
      <app-data-table
        [columns]="groupedTableColumns"
        [data]="groupedTableDataSignal"
        [pagination]="true"
        [pageSize]="groupedTablePageSize"
        [showToolbar]="false"
        [showFilters]="true"
        [searchable]="false"
      />
    </app-card>
  </section>
  <section>
    <app-card
      title="Drop Records"
      subtitle="All records ordered by date (newest first)"
      padding="sm"
    >
      <app-data-table
        [columns]="dropRecordsTableColumns"
        [data]="dropRecordsTableDataSignal"
        [pagination]="true"
        [pageSize]="dropRecordsTablePageSize"
        [showToolbar]="false"
        [showFilters]="true"
        [searchable]="false"
      />
    </app-card>
  </section>
      <ng-template #noSelection>
        <div class="rounded-lg border border-dashed border-gray-300 bg-gray-50 p-8 text-center text-sm text-gray-500">
          Select an employee to view detailed performance charts.
        </div>
      </ng-template>
    </div>
  </div>
</div>


