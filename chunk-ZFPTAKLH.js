import{h as S,m as U}from"./chunk-DFADLG5I.js";import{I as d,J as y,K as v,Lb as n,N as a,Ob as c,S as h,T as E,j as g,oa as l,z as f}from"./chunk-VUHZN6IL.js";import{a as s,b as o,d as u}from"./chunk-3A3XYTID.js";var C,p=u(()=>{"use strict";c();c();C=(()=>{class t{configKey="user_config";defaultConfig={adminEmails:["ragubose.s@gmail.com"],userEmails:["prakashmookiah@gmail.com"]};configSignal=l(this.loadConfig());config=this.configSignal.asReadonly();adminEmails=n(()=>this.configSignal().adminEmails);userEmails=n(()=>this.configSignal().userEmails);constructor(){this.loadConfig()}loadConfig(){try{let e=localStorage.getItem(this.configKey);if(e){let i=JSON.parse(e);if(i.adminEmails&&Array.isArray(i.adminEmails)&&i.userEmails&&Array.isArray(i.userEmails))return i}}catch(e){console.error("Error loading user config:",e)}return s({},this.defaultConfig)}saveConfig(e){try{localStorage.setItem(this.configKey,JSON.stringify(e)),this.configSignal.set(e)}catch(i){throw console.error("Error saving user config:",i),i}}updateAdminEmails(e){let i=this.configSignal();this.saveConfig(o(s({},i),{adminEmails:e.filter(r=>r.trim().length>0)}))}updateUserEmails(e){let i=this.configSignal();this.saveConfig(o(s({},i),{userEmails:e.filter(r=>r.trim().length>0)}))}addAdminEmail(e){let i=this.configSignal(),r=e.trim().toLowerCase();r&&!i.adminEmails.includes(r)&&this.saveConfig(o(s({},i),{adminEmails:[...i.adminEmails,r]}))}addUserEmail(e){let i=this.configSignal(),r=e.trim().toLowerCase();r&&!i.userEmails.includes(r)&&this.saveConfig(o(s({},i),{userEmails:[...i.userEmails,r]}))}removeAdminEmail(e){let i=this.configSignal();this.saveConfig(o(s({},i),{adminEmails:i.adminEmails.filter(r=>r!==e.toLowerCase())}))}removeUserEmail(e){let i=this.configSignal();this.saveConfig(o(s({},i),{userEmails:i.userEmails.filter(r=>r!==e.toLowerCase())}))}isAdminEmail(e){return this.adminEmails().includes(e.toLowerCase())}isUserEmail(e){return this.userEmails().includes(e.toLowerCase())}getRoleForEmail(e){let i=e.toLowerCase();return this.adminEmails().includes(i)?"admin":this.userEmails().includes(i)?"user":null}resetToDefault(){this.saveConfig(s({},this.defaultConfig))}clearConfig(){try{localStorage.removeItem(this.configKey),this.configSignal.set(s({},this.defaultConfig))}catch(e){console.error("Error clearing user config:",e)}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()});var x,w=u(()=>{"use strict";c();y();v();p();c();U();x=(()=>{class t{router;userConfigService=E(C);currentUserSignal=l(null);currentUser=this.currentUserSignal.asReadonly();isAuthenticated=n(()=>this.currentUserSignal()!==null);isAdmin=n(()=>this.currentUserSignal()?.role==="admin");tokenKey="auth_token";constructor(e){this.router=e,this.checkExistingSession()}login(e,i){return g({id:"1",name:this.getUserNameFromEmail(e),email:e.toLowerCase(),role:this.determineRole(e)}).pipe(f(1e3),d(r=>{this.currentUserSignal.set(r),localStorage.setItem(this.tokenKey,"mock_token_"+Date.now());let m=r.email.trim().toLowerCase();m.includes("@")&&!m.includes("/")?localStorage.setItem("user_email",m):console.error("Invalid email format detected:",r.email)}))}determineRole(e){return this.userConfigService.getRoleForEmail(e)||"user"}getUserNameFromEmail(e){return e.split("@")[0].split(/[._-]/).map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}logout(){this.currentUserSignal.set(null),localStorage.removeItem(this.tokenKey),this.router.navigate(["/login"])}checkExistingSession(){let e=localStorage.getItem(this.tokenKey),i=localStorage.getItem("user_email");if(e&&i){let r=i.trim().toLowerCase();r.includes("@")&&!r.includes("/")?this.currentUserSignal.set({id:"1",name:this.getUserNameFromEmail(r),email:r,role:this.determineRole(r)}):(console.warn("Corrupted email in localStorage, clearing:",i),localStorage.removeItem("user_email"),localStorage.removeItem(this.tokenKey))}}getToken(){return localStorage.getItem(this.tokenKey)}hasRole(e){return this.currentUser()?.role===e}hasAnyRole(e){let i=this.currentUser()?.role;return i?e.includes(i):!1}getCurrentUserEmail(){let e=this.currentUser()?.email;if(!e)return null;let i=e.trim().toLowerCase();if(i.includes("@")&&!i.includes("/"))return i;let r=localStorage.getItem("user_email");return r&&r.includes("@")&&!r.includes("/")?r.trim().toLowerCase():null}static \u0275fac=function(i){return new(i||t)(h(S))};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()});export{C as a,p as b,x as c,w as d};
